<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kl칛dtips f칬r barn</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 10px;
      background: #f9fbfd;
      color: #333;
      max-width: 480px;
      overflow-x: hidden;
    }
    h1, p {
      margin: 0;
      padding: 5px 0;
      text-align: center;
    }
    h1 {
      font-size: 1.3rem;
      color: #2c3e50;
    }
    p {
      font-size: 0.92rem;
      color: #555;
    }
    label, select, input[type=range], button {
      display: block;
      width: 100%;
      margin: 6px 0;
      font-size: 0.9rem;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 6px;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #2d77b6;
    }
    .weather, .recommendation {
      margin-top: 12px;
      padding: 12px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      font-size: 0.9rem;
    }
    .forecast-block {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 3px 0;
    }
    .forecast-block img {
      width: 28px;
      height: 28px;
    }
    .emoji {
      margin-right: 6px;
    }
    ul {
      padding-left: 1rem;
      margin: 0;
    }
    .ad-banner {
      margin-top: 15px;
      padding: 10px;
      background: #d184a6;
      border-radius: 8px;
      font-size: 0.9rem;
      text-align: center;
      color: white;
    }
    .ad-banner a {
      color: white;
      font-weight: bold;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Kl칛dtips f칬r barn</h1>
  <p>Anpassade f칬rslag utifr친n v칛der, 친lder och om barnet fryser l칛tt.</p>

  <label for="age">Barnets 친lder: <span id="ageVal">3</span> 친r</label>
  <input type="range" id="age" min="1" max="12" value="3" />

  <label for="sensitivity">Fryser barnet l칛tt?</label>
  <select id="sensitivity">
    <option value="cold">Ja, fryser l칛tt</option>
    <option value="normal" selected>Nej, normalt</option>
    <option value="warm">Nej, ofta varm</option>
  </select>

  <button onclick="getWeather()">Visa kl칛dtips</button>

  <div class="weather" id="weatherBox" style="display:none"></div>
  <div class="recommendation" id="recBox" style="display:none"></div>

  <div class="ad-banner">
    游꿀 Tips! Planerar du barnkalas?<br>
    <a href="https://tingeltangel.se" target="_blank">Kolla in dekorationer hos Tingeltangel.se</a>
  </div>

  <script>
    let currentLat = null;
    let currentLon = null;

    const weatherIcons = {
      1: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-day-sunny.svg",
      2: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-day-cloudy.svg",
      3: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-cloudy.svg",
      4: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-cloudy.svg",
      5: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-showers.svg",
      6: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-rain.svg",
      7: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-thunderstorm.svg",
      8: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-snow.svg",
      9: "https://cdn.jsdelivr.net/gh/erikflowers/weather-icons/svg/wi-fog.svg"
    };

    function getWeather() {
      if (!navigator.geolocation) {
        alert("Din webbl칛sare st칬der inte platsinfo.");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude.toFixed(4);
        const lon = pos.coords.longitude.toFixed(4);
        currentLat = lat;
        currentLon = lon;

        const smhiUrl = `https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/${lon}/lat/${lat}/data.json`;
        const locationUrl = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`;

        try {
          const [res, locRes] = await Promise.all([
            fetch(smhiUrl),
            fetch(locationUrl)
          ]);
          const data = await res.json();
          const locData = await locRes.json();
          const place = locData.address.city || locData.address.town || locData.address.village || "din plats";

          const times = data.timeSeries;
          const now = new Date();
          const todayStr = now.toLocaleDateString('sv-SE');

          const getForecastForHour = (hour) => {
            return times.find(t => {
              const d = new Date(t.validTime);
              return d.getHours() === hour && d.getDate() === now.getDate();
            });
          };

          const hours = [8, 12, 16];
          let weatherHTML = `<strong>SMHI-prognos f칬r ${place}, ${todayStr}:</strong><br>`;
          let temps = [], windSpeeds = [], weatherCodes = [];

          hours.forEach(hour => {
            const forecast = getForecastForHour(hour);
            if (forecast) {
              const date = new Date(forecast.validTime);
              const temp = forecast.parameters.find(p => p.name === "t").values[0];
              const wind = forecast.parameters.find(p => p.name === "ws").values[0];
              const apparent = (temp - wind * 0.7).toFixed(1);
              const weatherCode = forecast.parameters.find(p => p.name === "Wsymb2").values[0];
              const iconUrl = weatherIcons[weatherCode] || "";

              temps.push(temp);
              windSpeeds.push(wind);
              weatherCodes.push(weatherCode);

              weatherHTML += `
                <div class="forecast-block">
                  <img class="icon" src="${iconUrl}" alt="v칛derikon">
                  <span><strong>Kl. ${date.getHours()}:00</strong>: ${temp} 춿C (k칛nns som ${apparent} 춿C), Vind: ${wind} m/s</span>
                </div>
              `;
            }
          });

          document.getElementById("weatherBox").style.display = "block";
          document.getElementById("weatherBox").innerHTML = weatherHTML;

          showRecommendation(temps, windSpeeds, weatherCodes);
        } catch (err) {
          console.error(err);
          alert("Fel vid h칛mtning av v칛der eller platsinformation.");
        }
      });
    }

    // F칬rval 친lder p친 3 친r
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("age").value = 3;
      document.getElementById("ageVal").textContent = 3;
    });
  </script>
</body>
</html>
